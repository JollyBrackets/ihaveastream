<template>
 <v-container fluid class="pa-0">
    <filter-bar></filter-bar>
    <v-container>
      <p class="caption" v-if="searchTerm">
        <span class="mr-4">Showing results for:</span>
        <v-chip close small @click:close="resetSearch">{{ searchTerm }}</v-chip>
      </p>

      <template v-if="streams">
        <v-row wrap>
          <v-col cols="12" sm="6" md="4" lg="3" v-for="stream in streams" :key="stream.id">
            <explore-card
              :stream="stream"
              :title="stream.name"
              :id="stream.id"
              :day="stream.sessions[stream.sessions.length -1].start | moment('from', 'now')"
              img="https://source.unsplash.com/500x300/?yoga"
              location="ZÃ¼rich, Altstetten"
            />
          </v-col>
        </v-row>
        <pre>
        {{ streams }}
        </pre>
      </template>

      <template v-else>
        <v-skeleton-loader
          v-for="i in 10"
          :key="i"
          type="list-item-avatar-three-line"
          class="mx-auto"
        />
      </template>

    </v-container>
  </v-container>
</template>

<script>
import FilterBar from '@/components/FilterBar.vue'
import ExploreCard from '@/components/ExploreCard.vue'
export default {
  props: {
    searchTerm: {
      type: String,
      default: null
    }
  },
  components: { FilterBar, ExploreCard },
  name: 'Search',
  data: () => ({
    streams: null
  }),
  created() {
    this.requestData()
    /*this.$http.get('https://ip-api.com/json/?fields=statuscountryCode,region,zip')
      .then(response => {
        const zip = response.data.zip
        const country = response.data.countryCode


        //console.log({ zip, country })
      })*/
  },
  watch: {
    searchTerm() {
      this.requestData()
    }
  },
  methods: {
    requestData() {
      this.search({ name: this.$props.searchTerm || '' })
    },
    search({ name = "", price = { max: '' }, language = '', datetime = { from: '', to: '' } } = {}) {
      return this.$http.get(`api/v1/streams/?name=${name}&price_max=${price.max}&language=${language}&start_after=${datetime.from}&start_before=${datetime.to}`)
        .then(response => {
          this.streams = response.data  
        })
    },
    resetSearch () {
      this.$router.push('/search')
    }
  }
}

</script>
